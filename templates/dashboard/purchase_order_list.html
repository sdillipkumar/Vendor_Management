{% extends "base.html" %}

{% block content %}
<div class="p-6 animate-fade-in">
  <!-- Header Section -->
  <div class="mb-8 flex flex-col md:flex-row justify-between items-start md:items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">Purchase Orders</h1>
      <p class="text-gray-600 dark:text-gray-300">
        Manage and track all your purchase orders in one place
      </p>
    </div>
    <button class="mt-4 md:mt-0 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg transition-all flex items-center">
      <i class="fas fa-plus-circle mr-2"></i> <a href="{% url 'create_purchase_order_ui' %}">New Order</a>
    </button>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 transition-all hover:shadow-lg">
      <div class="flex items-center justify-between">

        <div>
          <p class="text-gray-500 dark:text-gray-400 text-sm">Total Orders</p>
          <h3 class="text-2xl font-bold text-gray-800 dark:text-white">{{ total_orders }}</h3>
        </div>

        <div class="bg-indigo-100 dark:bg-indigo-900 p-3 rounded-full">
          <i class="fas fa-file-invoice text-indigo-600 dark:text-indigo-300"></i>
        </div>
      </div>
      <div class="mt-4">
        {% if is_increase %}
    <span class="text-green-500 text-sm font-medium">
      ↑ {{ percentage_change }}% this month
    </span>
  {% else %}
    <span class="text-red-500 text-sm font-medium">
      ↓ {{ percentage_change }}% this month
    </span>
  {% endif %}
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 transition-all hover:shadow-lg">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-500 dark:text-gray-400 text-sm">Pending</p>
          <h3 class="text-2xl font-bold text-gray-800 dark:text-white">{{ pending_orders }}</h3>
        </div>
        <div class="bg-yellow-100 dark:bg-yellow-900 p-3 rounded-full">
          <i class="fas fa-clock text-yellow-600 dark:text-yellow-300"></i>
        </div>
      </div>
      <div class="mt-4">
        {% if is_increase %}
    <span class="text-green-500 text-sm font-medium">
      ↑ {{ percentage_change }}% this month
    </span>
  {% else %}
    <span class="text-red-500 text-sm font-medium">
      ↓ {{ percentage_change }}% this month
    </span>
  {% endif %}
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 transition-all hover:shadow-lg">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-500 dark:text-gray-400 text-sm">Completed</p>
          <h3 class="text-2xl font-bold text-gray-800 dark:text-white">{{ completed_orders }}</h3>
        </div>
        <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
          <i class="fas fa-check-circle text-green-600 dark:text-green-300"></i>
        </div>
      </div>
      <div class="mt-4">
        {% if is_increase %}
    <span class="text-green-500 text-sm font-medium">
      ↑ {{ percentage_change }}% this month
    </span>
  {% else %}
    <span class="text-red-500 text-sm font-medium">
      ↓ {{ percentage_change }}% this month
    </span>
  {% endif %}
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 transition-all hover:shadow-lg">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-gray-500 dark:text-gray-400 text-sm">Total Value</p>
          <h3 class="text-2xl font-bold text-gray-800 dark:text-white">₹{{ total_value }}</h3>
        </div>
        <div class="bg-purple-100 dark:bg-purple-900 p-3 rounded-full">
          <i class="fas fa-rupee-sign text-purple-600 dark:text-purple-300"></i>
        </div>
      </div>
      <div class="mt-4">
        {% if is_increase %}
    <span class="text-green-500 text-sm font-medium">
      ↑ {{ percentage_change }}% this month
    </span>
  {% else %}
    <span class="text-red-500 text-sm font-medium">
      ↓ {{ percentage_change }}% this month
    </span>
  {% endif %}
      </div>
    </div>
  </div>

  <!-- Search and Filter Section -->
<form method="get" class="mb-6 bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 transition-all">
  <div class="flex flex-col md:flex-row gap-4">

    <!-- 🔍 Search Box -->
    <div class="relative flex-grow">
      <input 
        type="text" 
        name="search" 
        value="{{ request.GET.search }}" 
        placeholder="Search purchase orders..." 
        class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-transparent focus:border-indigo-500 transition-all dark:text-white"
      >
      <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
    </div>

    <!-- ✅ Status Filter -->
    <select 
      name="status" 
      class="px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-transparent dark:text-white"
    >
      <option value="">All Status</option>
      {% for s in statuses %}
        <option value="{{ s }}" {% if request.GET.status == s %}selected{% endif %}>{{ s }}</option>
      {% endfor %}
    </select>

    <!-- ✅ Vendor Filter -->
    <select 
      name="vendor" 
      class="px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-transparent dark:text-white"
    >
      <option value="">All Vendors</option>
      {% for v in vendors %}
        <option value="{{ v.id }}" {% if request.GET.vendor == v.id|stringformat:"s" %}selected{% endif %}>
          {{ v.name }}
        </option>
      {% endfor %}
    </select>

  </div>
</form>

  <!-- Purchase Orders Table -->
  <!-- Purchase Orders Table -->
<div class="overflow-x-auto bg-white dark:bg-gray-900 rounded-xl shadow-md transition-all">
  <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
    <thead class="bg-gray-50 dark:bg-gray-800">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">PO Number</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Vendor</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Dates</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Amount</th>
        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
      </tr>
    </thead>

    <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700 transition-all">
      {% for order in purchase_orders %}
      <tr class="hover:bg-gray-50 dark:hover:bg-gray-800 transition duration-200 ease-in-out">

        <!-- PO Number -->
        <td class="px-6 py-4 whitespace-nowrap">
          <span class="text-sm font-semibold text-indigo-600 dark:text-indigo-400">
            #{{ order.po_number }}
          </span>
        </td>

        <!-- Vendor Info -->
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="flex items-center space-x-3">
            {% if order.vendor.logo %}
              <img src="{{ order.vendor.get_logo_url }}" 
                   class="h-10 w-10 rounded-full border border-gray-300 dark:border-gray-700 object-cover" 
                   alt="Vendor Logo">
            {% else %}
              <img src="https://via.placeholder.com/40" 
                   class="h-10 w-10 rounded-full border border-gray-300 dark:border-gray-700 object-cover" 
                   alt="Default Logo">
            {% endif %}
            <div>
              <p class="text-sm font-medium text-gray-900 dark:text-white">
                {{ order.vendor.name }}
              </p>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                {{ order.vendor.email }}
              </p>
            </div>
          </div>
        </td>

        <!-- Dates -->
        <td class="px-6 py-4 whitespace-nowrap text-sm">
          <p class="text-gray-800 dark:text-gray-100 font-medium">
            {{ order.issue_date|date:"M d, Y" }}
          </p>
          <p class="text-xs text-gray-500 dark:text-gray-400">
            Due: {{ order.due_date|date:"M d, Y" }}
          </p>
        </td>

        <!-- Status -->
        <td class="px-6 py-4 whitespace-nowrap">
          <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold 
            {% if order.status == 'Completed' %}
              bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300
            {% elif order.status == 'Pending' %}
              bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300
            {% elif order.status == 'Cancelled' %}
              bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300
            {% else %}
              bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300
            {% endif %}">
            {{ order.status }}
          </span>
        </td>

        <!-- Amount -->
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white font-medium">
          ₹{{ order.total_amount|floatformat:2 }}
        </td>

        <!-- Actions -->
        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
          <a href="{% url 'po-detail' order.id %}" 
             class="inline-flex items-center justify-center w-8 h-8 text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200 transition">
            <i class="fas fa-eye"></i>
          </a>
          <a href="{% url 'po-detail' order.id %}" 
             class="inline-flex items-center justify-center w-8 h-8 text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200 transition">
            <i class="fas fa-print"></i>
          </a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center py-6 text-gray-500 dark:text-gray-400 italic">
          No purchase orders found.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


<!-- Pagination -->
<div class="flex justify-between items-center mt-6">
  <div class="text-sm text-gray-500 dark:text-gray-400">
    Showing <span class="font-medium">{{ page_obj.start_index }}</span>
    to <span class="font-medium">{{ page_obj.end_index }}</span>
    of <span class="font-medium">{{ page_obj.paginator.count }}</span> results
  </div>

  <nav class="flex items-center space-x-2">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}"
         class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
        Previous
      </a>
    {% else %}
      <span class="px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed">
        Previous
      </span>
    {% endif %}

    {% for page in page_obj.paginator.page_range %}
      {% if page == page_obj.number %}
        <span class="px-4 py-2 rounded-lg bg-indigo-600 text-white">{{ page }}</span>
      {% else %}
        <a href="?page={{ page }}"
           class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
          {{ page }}
        </a>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}"
         class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
        Next
      </a>
    {% else %}
      <span class="px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed">
        Next
      </span>
    {% endif %}
  </nav>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize any purchase order specific interactions here
    const statusFilters = document.querySelectorAll('input[name="status-filter"]');
    statusFilters.forEach(filter => {
      filter.addEventListener('change', function() {
        // Filter logic would go here
        console.log('Filtering by:', this.value);
      });
    });
  });
</script>

<style>
  .animate-fade-in {
    animation: fadeIn 0.6s ease-out forwards;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  table {
    border-collapse: separate;
    border-spacing: 0;
  }
  
  table tr th,
  table tr td {
    border-bottom: 1px solid #e5e7eb;
    border-right: 1px solid #e5e7eb;
  }
  
  table tr th:first-child,
  table tr td:first-child {
    border-left: 1px solid #e5e7eb;
  }
  
  table tr th {
    border-top: 1px solid #e5e7eb;
  }
  
  /* top-left border-radius */
  table tr:first-child th:first-child {
    border-top-left-radius: 0.75rem;
  }
  
  /* top-right border-radius */
  table tr:first-child th:last-child {
    border-top-right-radius: 0.75rem;
  }
  
  /* bottom-left border-radius */
  table tr:last-child td:first-child {
    border-bottom-left-radius: 0.75rem;
  }
  
  /* bottom-right border-radius */
  table tr:last-child td:last-child {
    border-bottom-right-radius: 0.75rem;
  }
  
  .dark table tr th,
  .dark table tr td {
    border-color: #374151;
  }
</style>
{% endblock %}
